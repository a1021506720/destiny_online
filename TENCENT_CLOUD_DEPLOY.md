# ğŸï¸ è…¾è®¯äº‘è½»é‡åº”ç”¨æœåŠ¡å™¨éƒ¨ç½²è¯¦ç»†æŒ‡å—

## ğŸ“‹ å½“å‰çŠ¶æ€æ£€æŸ¥

### âœ… å·²å®Œæˆçš„å‡†å¤‡å·¥ä½œ
- [x] Spring Bootåº”ç”¨å·²æ„å»ºå®Œæˆ
- [x] ç”Ÿäº§ç¯å¢ƒé…ç½®å·²ä¼˜åŒ–
- [x] è‡ªåŠ¨éƒ¨ç½²è„šæœ¬å·²åˆ›å»º
- [x] å‰ç«¯é…ç½®å·²æ›´æ–°

### ğŸ“¦ æœ¬åœ°æ„å»ºç»“æœ
```bash
æ„å»ºæˆåŠŸï¼ç”Ÿæˆçš„jaråŒ…ï¼š
/Users/zenghao/Documents/project/destiny_online/target/destiny-online-0.0.1-SNAPSHOT.jar
å¤§å°ï¼šçº¦ 15MB
```

---

## ğŸ›’ ç¬¬ä¸€æ­¥ï¼šè´­ä¹°è…¾è®¯äº‘æœåŠ¡å™¨ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰

### 1.1 è®¿é—®è´­ä¹°é¡µé¢
- é“¾æ¥ï¼šhttps://cloud.tencent.com/product/lighthouse
- ç‚¹å‡» **"ç«‹å³é€‰è´­"**

### 1.2 é…ç½®é€‰æ‹©ï¼ˆé‡è¦ï¼‰
```
åœ°åŸŸï¼šå¹¿å· æˆ– ä¸Šæµ·
é•œåƒï¼šåº”ç”¨é•œåƒ â†’ Javaç¯å¢ƒ
å¥—é¤ï¼š1æ ¸2G 40GB SSD 3Mbps
ä»·æ ¼ï¼š30å…ƒ/å¹´ï¼ˆæ–°ç”¨æˆ·ï¼‰
æ—¶é•¿ï¼š1å¹´
```

### 1.3 å®Œæˆè´­ä¹°
- ç¡®è®¤è®¢å• â†’ æ”¯ä»˜ â†’ ç­‰å¾…å¼€é€šï¼ˆé€šå¸¸2åˆ†é’Ÿå†…ï¼‰

---

## âš™ï¸ ç¬¬äºŒæ­¥ï¼šè·å–æœåŠ¡å™¨ä¿¡æ¯

### 2.1 è¿›å…¥æ§åˆ¶å°
1. ç™»å½•è…¾è®¯äº‘æ§åˆ¶å°
2. è¿›å…¥ **"è½»é‡åº”ç”¨æœåŠ¡å™¨"**
3. æ‰¾åˆ°ä½ åˆšè´­ä¹°çš„æœåŠ¡å™¨

### 2.2 è®°å½•é‡è¦ä¿¡æ¯
```bash
å…¬ç½‘IPï¼šxxx.xxx.xxx.xxx  # è®°ä¸‹è¿™ä¸ªIP
ç”¨æˆ·åï¼šlighthouse
å¯†ç ï¼šï¼ˆç‚¹å‡»é‡ç½®å¯†ç è®¾ç½®ï¼‰
```

### 2.3 é…ç½®SSHè¿æ¥ï¼ˆæ¨èï¼‰
```bash
# åœ¨ä½ çš„Macä¸Šç”ŸæˆSSHå¯†é’¥ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
ssh-keygen -t rsa -b 2048

# æŸ¥çœ‹å…¬é’¥
cat ~/.ssh/id_rsa.pub

# åœ¨è…¾è®¯äº‘æ§åˆ¶å°ï¼š
# æœåŠ¡å™¨è¯¦æƒ… â†’ å¯†é’¥ â†’ ç»‘å®šå¯†é’¥ â†’ ç²˜è´´å…¬é’¥å†…å®¹
```

---

## ğŸ”’ ç¬¬ä¸‰æ­¥ï¼šé…ç½®å®‰å…¨ç»„

### 3.1 å¼€æ”¾ç«¯å£
åœ¨è…¾è®¯äº‘æ§åˆ¶å°ï¼š
1. ç‚¹å‡»ä½ çš„æœåŠ¡å™¨
2. é€‰æ‹© **"é˜²ç«å¢™"** æ ‡ç­¾
3. ç‚¹å‡» **"æ·»åŠ è§„åˆ™"**

### 3.2 æ·»åŠ ä»¥ä¸‹è§„åˆ™
```
åº”ç”¨ç±»å‹ï¼šè‡ªå®šä¹‰
åè®®ï¼šTCP
ç«¯å£ï¼š8080
ç­–ç•¥ï¼šå…è®¸
æ¥æºï¼š0.0.0.0/0
å¤‡æ³¨ï¼šSpring Boot APIç«¯å£
```

---

## ğŸš€ ç¬¬å››æ­¥ï¼šä¸€é”®éƒ¨ç½²åº”ç”¨

### æ–¹æ³•Aï¼šä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# åœ¨ä½ çš„Macä¸Šæ‰§è¡Œ
cd /Users/zenghao/Documents/project/destiny_online

# æ›¿æ¢ä¸ºä½ çš„å®é™…æœåŠ¡å™¨IP
./deploy.sh ä½ çš„æœåŠ¡å™¨IPåœ°å€

# ä¾‹å¦‚ï¼š
# ./deploy.sh 123.456.789.123
```

è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆï¼š
- âœ… ä¸Šä¼ jaråŒ…åˆ°æœåŠ¡å™¨
- âœ… åˆ›å»ºæ—¥å¿—ç›®å½•
- âœ… åœæ­¢æ—§ç‰ˆæœ¬åº”ç”¨
- âœ… å¯åŠ¨æ–°ç‰ˆæœ¬åº”ç”¨
- âœ… æ£€æŸ¥åº”ç”¨å¥åº·çŠ¶æ€

### æ–¹æ³•Bï¼šæ‰‹åŠ¨éƒ¨ç½²ï¼ˆå¦‚æœè„šæœ¬å¤±è´¥ï¼‰

#### 4.1 ä¸Šä¼ æ–‡ä»¶
```bash
# ä¸Šä¼ jaråŒ…
scp target/destiny-online-0.0.1-SNAPSHOT.jar lighthouse@ä½ çš„IP:/home/lighthouse/
```

#### 4.2 è¿æ¥æœåŠ¡å™¨
```bash
ssh lighthouse@ä½ çš„IP
```

#### 4.3 åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
```bash
# åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p logs

# å¯åŠ¨åº”ç”¨
nohup java -jar -Dspring.profiles.active=prod destiny-online-0.0.1-SNAPSHOT.jar > logs/app.log 2>&1 &

# æŸ¥çœ‹æ—¥å¿—
tail -f logs/app.log
```

---

## ğŸ§ª ç¬¬äº”æ­¥ï¼šæµ‹è¯•åº”ç”¨

### 5.1 å¥åº·æ£€æŸ¥
```bash
# åœ¨æµè§ˆå™¨æˆ–å‘½ä»¤è¡Œæµ‹è¯•
curl http://ä½ çš„IP:8080/actuator/health

# æœŸæœ›ç»“æœï¼š
{"status":"UP"}
```

### 5.2 APIåŠŸèƒ½æµ‹è¯•
```bash
# æµ‹è¯•å…«å­—è®¡ç®—API
curl -X POST http://ä½ çš„IP:8080/api/bazi/calculate \
  -H "Content-Type: application/json" \
  -d '{"date": "1990-01-01", "time": "12:00", "dateType": "SOLAR"}'

# åº”è¯¥è¿”å›è¯¦ç»†çš„å…«å­—æ•°æ®
```

### 5.3 è·å–APIä¿¡æ¯
```bash
curl http://ä½ çš„IP:8080/api/bazi/info
```

---

## ğŸŒ ç¬¬å…­æ­¥ï¼šæ›´æ–°å‰ç«¯é…ç½®

### 6.1 ä¿®æ”¹å‰ç«¯APIåœ°å€
ç¼–è¾‘ `/Users/zenghao/Documents/project/destiny/config.js`ï¼š

```javascript
production: {
    apiBaseURL: 'http://ä½ çš„å®é™…IP:8080',
    corsEnabled: false
},
```

### 6.2 æµ‹è¯•å‰ç«¯è¿æ¥
1. ç”¨æµè§ˆå™¨æ‰“å¼€å‰ç«¯é¡µé¢
2. æ‰“å¼€å¼€å‘è€…å·¥å…·æŸ¥çœ‹Console
3. å°è¯•ç”Ÿæˆä¸€ä¸ªæµ‹è¯•æŠ¥å‘Š
4. ç¡®è®¤APIè°ƒç”¨æˆåŠŸ

---

## ğŸ“ˆ ç¬¬ä¸ƒæ­¥ï¼šåº”ç”¨ç®¡ç†

### 7.1 æŸ¥çœ‹åº”ç”¨çŠ¶æ€
```bash
# SSHè¿æ¥æœåŠ¡å™¨å
ps aux | grep java                    # æŸ¥çœ‹Javaè¿›ç¨‹
tail -f logs/app.log                  # æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f logs/destiny-online.log       # æŸ¥çœ‹åº”ç”¨æ—¥å¿—
```

### 7.2 é‡å¯åº”ç”¨
```bash
# åœæ­¢åº”ç”¨
pkill -f "destiny-online"

# å¯åŠ¨åº”ç”¨
nohup java -jar -Dspring.profiles.active=prod destiny-online-0.0.1-SNAPSHOT.jar > logs/app.log 2>&1 &
```

### 7.3 è®¾ç½®å¼€æœºè‡ªå¯ï¼ˆå¯é€‰ï¼‰
```bash
# åˆ›å»ºsystemdæœåŠ¡æ–‡ä»¶
sudo nano /etc/systemd/system/destiny-online.service
```

å†…å®¹ï¼š
```ini
[Unit]
Description=Destiny Online Service
After=network.target

[Service]
Type=simple
User=lighthouse
WorkingDirectory=/home/lighthouse
ExecStart=/usr/bin/java -jar -Dspring.profiles.active=prod destiny-online-0.0.1-SNAPSHOT.jar
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

å¯ç”¨æœåŠ¡ï¼š
```bash
sudo systemctl enable destiny-online
sudo systemctl start destiny-online
sudo systemctl status destiny-online
```

---

## ğŸ¯ æˆåŠŸæ ‡å¿—

å®Œæˆéƒ¨ç½²åï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

### âœ… åç«¯æœåŠ¡æ­£å¸¸
- [ ] `http://ä½ çš„IP:8080/actuator/health` è¿”å› `{"status":"UP"}`
- [ ] `http://ä½ çš„IP:8080/api/bazi/info` è¿”å›APIä¿¡æ¯
- [ ] æ‰€æœ‰APIç«¯ç‚¹æ­£å¸¸å“åº”

### âœ… å‰ç«¯åŠŸèƒ½æ­£å¸¸
- [ ] é¡µé¢æ­£å¸¸åŠ è½½
- [ ] è¡¨å•æäº¤æˆåŠŸ
- [ ] å…«å­—ã€å¤§è¿ã€å­å¹³æœ¯æ•°æ®æ­£ç¡®æ˜¾ç¤º
- [ ] å‘½ç†è§£è¯»æ­£å¸¸ç”Ÿæˆ

---

## ğŸ†˜ æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šæ— æ³•è®¿é—®8080ç«¯å£
**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
sudo ufw status
sudo ufw allow 8080

# æ£€æŸ¥è…¾è®¯äº‘å®‰å…¨ç»„è®¾ç½®
```

### é—®é¢˜2ï¼šåº”ç”¨å¯åŠ¨å¤±è´¥
**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
tail -n 50 logs/app.log

# æ£€æŸ¥Javaç‰ˆæœ¬
java -version

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
free -h
```

### é—®é¢˜3ï¼šå‰ç«¯æ— æ³•è°ƒç”¨åç«¯API
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥å‰ç«¯config.jsä¸­çš„IPåœ°å€æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤æµè§ˆå™¨Consoleæ²¡æœ‰CORSé”™è¯¯
3. æµ‹è¯•APIæ˜¯å¦å¯ä»¥ç›´æ¥è®¿é—®

---

## ğŸ’° è´¹ç”¨è¯´æ˜

### é¦–å¹´è´¹ç”¨ï¼š30å…ƒ
- åŒ…å«ï¼š1æ ¸2GæœåŠ¡å™¨ + 40Gå­˜å‚¨ + 3Må¸¦å®½
- ç»­è´¹ï¼š108å…ƒ/å¹´

### æµé‡è´¹ç”¨ï¼šå…è´¹
- è½»é‡æœåŠ¡å™¨åŒ…å«å……è¶³çš„æµé‡åŒ…
- å¯¹äºä½ çš„åº”ç”¨å®Œå…¨å¤Ÿç”¨

---

## ğŸ‰ ä¸‹ä¸€æ­¥è®¡åˆ’

1. **åŸŸåç»‘å®š**ï¼ˆå¯é€‰ï¼‰
   - è´­ä¹°åŸŸåï¼šè…¾è®¯äº‘åŸŸåæ³¨å†Œçº¦29å…ƒ/å¹´
   - é…ç½®è§£æï¼šå…è´¹

2. **SSLè¯ä¹¦**ï¼ˆå¯é€‰ï¼‰
   - è…¾è®¯äº‘å…è´¹SSLè¯ä¹¦
   - å‡çº§ä¸ºHTTPSè®¿é—®

3. **å‰ç«¯éƒ¨ç½²**
   - æ¨èä½¿ç”¨Vercelæˆ–Netlify
   - å…è´¹é™æ€ç½‘ç«™æ‰˜ç®¡

4. **ç›‘æ§å‘Šè­¦**ï¼ˆå¯é€‰ï¼‰
   - é…ç½®æœåŠ¡å™¨ç›‘æ§
   - åº”ç”¨å¼‚å¸¸è‡ªåŠ¨é€šçŸ¥

---

éœ€è¦æˆ‘å¸®ä½ æ‰§è¡Œå“ªä¸ªæ­¥éª¤ï¼Ÿæˆ–è€…é‡åˆ°ä»»ä½•é—®é¢˜éƒ½å¯ä»¥éšæ—¶è¯¢é—®ï¼